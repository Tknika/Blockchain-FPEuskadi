{% extends "base.html" %}

{% block title %}Ekozir Dashboard{% endblock %}

{% block content %}

<!-- Banner displayed when logged in -->
<div id="userBanner" style="display: none;" class="user-banner">
  <div class="banner-content">
    <span><strong>Logged in as:</strong> <span id="bannerUsername"></span></span>
    <div class="banner-actions">
      <button id="copyPublicKeyButton" class="copy-button">Copy Public Key</button>
      <button id="logoutButtonBanner">Logout</button>
    </div>
  </div>
</div>

<pre id="walletInfo" class="info-panel">Not logged in</pre>

<!-- Login/Signup buttons shown outside cards when not logged in -->
<div id="authButtons" class="auth-buttons">
  <button id="showLoginButton">Login</button>
  <button id="showSignUpButton">Sign Up</button>
</div>

<section class="card" id="loginSection" style="display: none;">
  <h2>Login</h2>
  <p>
    Enter your password to access your groups and messages.
  </p>
  <input id="loginPassword" type="password" placeholder="Password"/>
  <div class="button-row">
    <button id="loginButton">Login</button>
    <button id="cancelLoginButton">Cancel</button>
  </div>
  <p id="loginStatus" class="muted"></p>
</section>

<section class="card" id="signUpSection" style="display: none;">
  <h2>Sign Up</h2>
  <p>
    Create a new account. Your password will be used to derive your encryption key.
  </p>
  <p id="signInStatus" class="muted">Enter username and password to sign up.</p>
  <input id="userNameInput" type="text" placeholder="Your username"/>
  <input id="passwordInput" type="password" placeholder="Your password"/>
  <div class="button-row">
    <button id="signUp">Sign Up</button>
    <button id="cancelSignUpButton">Cancel</button>
  </div>
</section>

<section class="card" data-requires-signin>
  <h2>Create Group</h2>
  <p>
    Define a group name. You can add members later in the Manage Membership section.
  </p>
  <input id="groupName" type="text" placeholder="Group name" />
  <button id="createGroup">Create Group</button>
</section>

<section class="card" data-requires-signin>
  <h2>Manage Membership</h2>
  <p>
    Add or remove participants when you are the group creator. Paste the public key (JSON format) of the member you want to add.
  </p>
  <select id="memberGroupSelect">
    <option value="">Select one of your groups</option>
  </select>
  <textarea id="memberPublicKey" rows="4" placeholder="Paste public key (JSON format) here..."></textarea>
  <div class="button-row">
    <button id="addMember">Add Member</button>
    <button id="removeMember">Remove Member</button>
  </div>
</section>

<section class="card" data-requires-signin>
  <h2>Send Message</h2>
  <p>
    Select a group and choose recipients. Messages are stored encrypted.
  </p>
  <select id="messageGroupSelect">
    <option value="">Select one of your groups</option>
  </select>
  <div id="recipientSelection" style="display: none;">
    <p>Select recipients:</p>
    <div id="recipientCheckboxes"></div>
  </div>
  <textarea
    id="messageContent"
    rows="3"
    placeholder="Type your message here (it will be encrypted automatically before sending)"
    style="display: none;"
  ></textarea>
  <button id="sendMessage" style="display: none;">Send Message</button>
</section>

<section class="card" data-requires-signin>
  <h2>Your Groups</h2>
  <p>
    Select a group to inspect members and messages.
  </p>
  <button id="refreshGroups">Refresh Groups</button>
  <div id="groupsList" class="list-panel"></div>
</section>

<section class="card" data-requires-signin>
  <h2>Group Messages</h2>
  <p>
    View encrypted content, keys, and confirmation status.
  </p>
  <div id="messagesList" class="list-panel"></div>
</section>

<script>
  // Inject configuration for the front-end controller.
  window.APP_CONFIG = {
    contractAddress: "{{ contract_address }}",
    chainId: "{{ chain_id }}",
    besuRpc: "{{ besu_rpc }}"
  };
</script>
{% endblock %}
