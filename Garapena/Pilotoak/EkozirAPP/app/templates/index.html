{% extends "base.html" %}

{% block title %}Ekozir Dashboard{% endblock %}

{% block content %}
<section class="card">
  <h2>Wallet Connection</h2>
  <p>
    Connect your MetaMask account to sign transactions against the Besu network.
  </p>
  <button id="connectWallet">Connect MetaMask</button>
  <pre id="walletInfo" class="info-panel">Not connected</pre>
</section>

<section class="card" id="signUpSection" style="display: none;">
  <h2>Sign Up</h2>
  <p>
    Publish your encryption public key and name so other group members can share secrets.
  </p>
  <p id="signInStatus" class="muted">Connect your wallet to check registration status.</p>
  <input id="userNameInput" type="text" placeholder="Your name" />
  <textarea id="publicKeyInput" rows="3" placeholder="Paste your public key"></textarea>
  <div class="button-row">
    <button id="autoRegisterPublicKey">Sign in with MetaMask</button>
    <button id="signUp">Sign Up</button>
  </div>
</section>

<section class="card" data-requires-signin>
  <h2>Create Group</h2>
  <p>
    Define a group name and optional comma-separated initial members.
  </p>
  <input id="groupName" type="text" placeholder="Group name" />
  <input
    id="groupMembers"
    type="text"
    placeholder="0x123...,0x456..."
  />
  <button id="createGroup">Create Group</button>
</section>

<section class="card" data-requires-signin>
  <h2>Manage Membership</h2>
  <p>
    Add or remove participants when you are the group creator.
  </p>
  <select id="memberGroupSelect">
    <option value="">Select one of your groups</option>
  </select>
  <input id="memberAddress" type="text" placeholder="0x..." />
  <div class="button-row">
    <button id="addMember">Add Member</button>
    <button id="removeMember">Remove Member</button>
  </div>
</section>

<section class="card" data-requires-signin>
  <h2>Send Message</h2>
  <p>
    Select a group and choose recipients. Messages are stored encrypted.
  </p>
  <select id="messageGroupSelect">
    <option value="">Select one of your groups</option>
  </select>
  <div id="recipientSelection" style="display: none;">
    <p>Select recipients:</p>
    <div id="recipientCheckboxes"></div>
  </div>
  <textarea
    id="messageContent"
    rows="3"
    placeholder="Type your message here (it will be encrypted automatically before sending)"
    style="display: none;"
  ></textarea>
  <button id="sendMessage" style="display: none;">Send Message</button>
</section>

<section class="card" data-requires-signin>
  <h2>Your Groups</h2>
  <p>
    Select a group to inspect members and messages.
  </p>
  <button id="refreshGroups">Refresh Groups</button>
  <div id="groupsList" class="list-panel"></div>
</section>

<section class="card" data-requires-signin>
  <h2>Group Messages</h2>
  <p>
    View encrypted content, keys, and confirmation status.
  </p>
  <div id="messagesList" class="list-panel"></div>
</section>

<script>
  // Inject configuration for the front-end controller.
  window.APP_CONFIG = {
    contractAddress: "{{ contract_address }}",
    chainId: "{{ chain_id }}",
    besuRpc: "{{ besu_rpc }}"
  };
</script>
{% endblock %}

