{% extends "base.html" %}

{% block title %}Ekozir Dashboard{% endblock %}

{% block content %}

<pre id="walletInfo" class="info-panel">Not logged in</pre>

<!-- User info section displayed when logged in -->
<section class="card" id="userInfoSection" style="display: none;" data-requires-signin>
  <h2>Your Account Information</h2>
  <p>
    Share your username and public key with others so they can add you to groups.
  </p>
  <div id="userInfoContent">
    <p><strong>Username:</strong> <span id="displayUsername"></span></p>
    <p><strong>Public Key:</strong></p>
    <pre id="displayPublicKey" class="info-panel" style="word-break: break-all; white-space: pre-wrap;"></pre>
  </div>
  <button id="logoutButtonTop" style="margin-top: 10px;">Logout</button>
</section>

<section class="card" id="loginSection">
  <h2>Login</h2>
  <p>
    Enter your username and password to access your groups and messages.
  </p>
  <input id="loginUsername" type="text" placeholder="Username"/>
  <input id="loginPassword" type="password" placeholder="Password"/>
  <div class="button-row">
    <button id="loginButton">Login</button>
    <button id="showSignUpButton">Sign Up</button>
  </div>
  <p id="loginStatus" class="muted"></p>
</section>

<section class="card" id="signUpSection" style="display: none;">
  <h2>Sign Up</h2>
  <p>
    Create a new account. Your password will be used to derive your encryption key.
  </p>
  <p id="signInStatus" class="muted">Enter username and password to sign up.</p>
  <input id="userNameInput" type="text" placeholder="Your username"/>
  <input id="passwordInput" type="password" placeholder="Your password"/>
  <div class="button-row">
    <button id="signUp">Sign Up</button>
    <button id="backToLoginButton">Back to Login</button>
  </div>
</section>

<section class="card" data-requires-signin>
  <h2>Create Group</h2>
  <p>
    Define a group name and optional comma-separated initial member usernames (they must be registered).
  </p>
  <input id="groupName" type="text" placeholder="Group name" />
  <input
    id="groupMembers"
    type="text"
    placeholder="username1,username2..."
    value=""
  />
  <button id="createGroup">Create Group</button>
</section>

<section class="card" data-requires-signin>
  <h2>Manage Membership</h2>
  <p>
    Add or remove participants when you are the group creator.
  </p>
  <select id="memberGroupSelect">
    <option value="">Select one of your groups</option>
  </select>
  <input id="memberUsername" type="text" placeholder="Username" value=""/>
  <div class="button-row">
    <button id="addMember">Add Member</button>
    <button id="removeMember">Remove Member</button>
  </div>
</section>

<section class="card" data-requires-signin>
  <h2>Send Message</h2>
  <p>
    Select a group and choose recipients. Messages are stored encrypted.
  </p>
  <select id="messageGroupSelect">
    <option value="">Select one of your groups</option>
  </select>
  <div id="recipientSelection" style="display: none;">
    <p>Select recipients:</p>
    <div id="recipientCheckboxes"></div>
  </div>
  <textarea
    id="messageContent"
    rows="3"
    placeholder="Type your message here (it will be encrypted automatically before sending)"
    style="display: none;"
  ></textarea>
  <button id="sendMessage" style="display: none;">Send Message</button>
</section>

<section class="card" data-requires-signin>
  <h2>Your Groups</h2>
  <p>
    Select a group to inspect members and messages.
  </p>
  <button id="refreshGroups">Refresh Groups</button>
  <button id="logoutButton" style="margin-left: 10px;">Logout</button>
  <div id="groupsList" class="list-panel"></div>
</section>

<section class="card" data-requires-signin>
  <h2>Group Messages</h2>
  <p>
    View encrypted content, keys, and confirmation status.
  </p>
  <div id="messagesList" class="list-panel"></div>
</section>

<script>
  // Inject configuration for the front-end controller.
  window.APP_CONFIG = {
    contractAddress: "{{ contract_address }}",
    chainId: "{{ chain_id }}",
    besuRpc: "{{ besu_rpc }}"
  };
</script>
{% endblock %}
